package {{packageName}};

import io.polyapi.client.internal.proxy.PolyProxyFactory;
import io.polyapi.client.internal.model.PolyContext;
import io.polyapi.client.api.model.websocket.WebhookEventConsumer;
import io.polyapi.client.api.AuthTokenEventConsumer;
import io.polyapi.client.internal.proxy.WebhookHandlerFactory;
import io.polyapi.client.api.model.PolyEntity;
{{~#each specifications}}
    {{~#ifIsType this "ServerFunctionSpecification"}}
        {{~#each this.imports}}
import {{{this}}};
        {{~/each}}
    {{~/ifIsType}}
    {{~#ifIsType this "CustomFunctionSpecification"}}
        {{~#each this.imports}}
import {{{this}}};
        {{~/each}}
    {{~/ifIsType}}
    {{~#ifIsType this "ApiFunctionSpecification"}}
        {{~#each this.imports}}
import {{{this}}};
        {{~/each}}
    {{~/ifIsType}}
    {{~#ifIsType this "ServerVariableSpecification"}}
        {{~#each this.imports}}
import {{{this}}};
        {{~/each}}
    {{~else}}
import {{{packageName}}}.{{{className}}};
    {{~/ifIsType}}
{{~/each}}
{{#each subcontexts}}
import {{{packageName}}}.{{{className}}};
{{~/each}}


public class {{className}} extends PolyContext {
{{~#each specifications}}
    {{~#ifIsType this "ServerVariableSpecification"}}
    private final {{className}}Handler {{name}}Handler;
    @PolyEntity("{{id}}")
    public final {{{type}}} {{name}};
    {{~else}}
    private final {{className}} {{name}};
    {{~/ifIsType}}
{{~/each}}
{{#each subcontexts}}
    public final {{className}} {{name}};
{{~/each}}

public {{className}}(PolyProxyFactory proxyFactory, WebhookHandlerFactory webhookHandlerFactory) {
super(proxyFactory, webhookHandlerFactory);
{{~#each specifications}}
    {{~#ifIsType this "ServerFunctionSpecification"}}
        this.{{name}} = createServerFunctionProxy({{className}}.class);
    {{~/ifIsType}}
    {{~#ifIsType this "CustomFunctionSpecification"}}
        this.{{name}} = createCustomFunctionProxy({{className}}.class);
    {{~/ifIsType}}
    {{~#ifIsType this "ApiFunctionSpecification"}}
        this.{{name}} = createApiFunctionProxy({{className}}.class);
    {{~/ifIsType}}
    {{~#ifIsType this "ServerVariableSpecification"}}
        this.{{name}}Handler = createServerVariableHandler({{className}}Handler.class);
        this.{{name}} = createServerVariableProxy("{{{type}}}", "{{{packageName}}}");
    {{~/ifIsType}}
    {{~#ifIsType this "WebhookHandleSpecification"}}
        this.{{name}} = createWebhookHandle({{className}}.class);
    {{~/ifIsType}}
    {{~#ifIsType this "AuthFunctionSpecification"}}
        this.{{name}} = createWebhookHandle({{className}}.class);
    {{~/ifIsType}}
{{~/each}}
{{#each subcontexts}}
    this.{{name}} = new {{className}}(proxyFactory, webhookHandlerFactory);
{{~/each}}
}

{{~#each specifications}}
    {{~#ifIsType this "ApiFunctionSpecification"}}
        public  {{{this.resultType}}} {{name}}({{{renderArguments this}}}) {
        {{~#if function.returnsValue}}
            return
        {{~else}}
        {{~/if}} {{name}}.{{name}}({{~#each function.arguments}}{{inCodeName}}{{~#unless
                @last}}, {{~/unless}}{{~/each}});
        }

        public {{{this.className}}} get{{{this.className}}}ApiFunction() {
            return this.{{{name}}};
        }
    {{~/ifIsType}}

    {{~#ifIsType this "CustomFunctionSpecification"}}
        {{~#if this.isJava}}
            public {{{this.resultType}}} {{name}}({{{renderArguments this}}}) {
            {{~#if function.returnsValue}}
                return
            {{~else}}
            {{~/if}} {{name}}.{{name}}({{~#each function.arguments}}{{inCodeName}}{{~#unless
                    @last}}, {{~/unless}}{{~/each}});
            }
        {{~/if}}
    {{~/ifIsType}}

    {{~#ifIsType this "ServerFunctionSpecification"}}
        public {{{this.resultType}}} {{name}}({{{renderArguments this}}}) {
        {{~#if function.returnsValue}}
            return
        {{~else}}
        {{~/if}} {{name}}.{{name}}({{~#each function.arguments}}{{inCodeName}}{{~#unless
                @last}}, {{~/unless}}{{~/each}});
        }

        public {{{this.className}}} get{{{this.className}}}ServerFunction() {
        return this.{{{name}}};
        }
    {{~/ifIsType}}

    {{~#ifIsType this "WebhookHandleSpecification"}}
        public void {{name}}(WebhookEventConsumer<{{{function.arguments.0.type.spec.arguments.0.type.inCodeType}}}> callback) {
            this.{{name}}.{{name}}(callback);
        }

        public {{{this.className}}} get{{{this.className}}}WebhookHandle() {
            return this.{{{name}}};
        }
    {{~/ifIsType}}

    {{~#ifIsType this "AuthFunctionSpecification"}}
        {{~#if subResource}}
            public void {{name}}(String token) {
            this.{{name}}.{{name}}(token);
            }
        {{~else}}
            public void getToken(String clientId, String clientSecret{{#if
                    audienceRequired}}, String audience{{/if}}, String[] scopes, AuthTokenEventConsumer callback) {
            this.{{name}}.getToken(clientId, clientSecret{{#if audienceRequired}}, audience{{/if}}, scopes, callback);
            }

            public void getToken(String clientId, String clientSecret{{#if
                    audienceRequired}}, String audience{{/if}}, String[] scopes, AuthTokenEventConsumer callback, AuthTokenOptions options) {
            this.{{name}}.getToken(clientId, clientSecret{{#if
                    audienceRequired}}, audience{{/if}}, scopes, callback, options);
            }
        {{~/if}}

        public {{{this.className}}} get{{{this.className}}}AuthFunction() {
            return this.{{{name}}};
        }
    {{~/ifIsType}}

    {{~#ifIsType this "ServerVariableSpecification"}}
        public void update{{{className}}}Variable({{{type}}} value) {
            this.{{name}}Handler.update(value);
        }

    {{~#if variable.secret}}
    {{~else}}
        public {{{type}}} get{{{className}}}Variable() {
            return this.{{name}}Handler.get();
        }
    {{/if}}

    {{~/ifIsType}}
{{~/each}}
}
