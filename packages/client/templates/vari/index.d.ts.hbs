{{#each contexts}}
/// <reference path="./{{fileName}}" />
{{/each}}

declare module vari {
  type ArrayChain<K extends string, PrevChain extends string = ''> = `${PrevChain}[${K}]`;
  type ObjChain<Key extends string, PrevChain extends string = '', RootLevel extends boolean = true> = `${PrevChain}${RootLevel extends true ? '' : '.'}${Key}`;
  type Keys<T> = Exclude<keyof T, keyof [] | keyof string | keyof number>;

  type PathValue<T extends Record<string, any>, PrevChain extends string = '', RootLevel extends boolean = true, K extends keyof T = Keys<T>> = K extends string ?
      T extends readonly any[] ? ArrayChain<K, PrevChain> | PathValue<T[K],ArrayChain<K, PrevChain>, false> :
      T extends Record<string, any> ? ObjChain<K, PrevChain, RootLevel> | PathValue<T[K], ObjChain<K, PrevChain, RootLevel>, false> :
      `${K & string}`
  : never;

  type UnregisterOnUpdateHandler = () => void;
  interface VariableChangeEvent<T> {
    type: 'update' | 'delete';
    secret: boolean;
    id: string;
    previousValue: T;
    /**
     * Updated value of the variable or null if the variable was deleted.
     */
    currentValue: T | null;
    updateTime: number;
    /**
     * User ID or Application ID of the user or application that updated the variable.
     */
    updatedBy: string;
    updatedFields: ('value' | 'secret')[];
  };
  interface VariableUpdateResponse<T> {
    data: {
      id: string;
      context: string;
      name: string;
      description: string;
      visibility: 'ENVIRONMENT' | 'TENANT' | 'PUBLIC';
      secret: boolean;
      value?: T
    }
    status: number;
    headers: Record<string, string>;
  }

  type OnUpdateOptions = {
    /**
     * Filter updates by type of event
     */
    type?: 'update' | 'delete';
    /**
     * Filter updates by secret or non-secret variables
     */
    secret?: boolean;
  };

  interface Vari {
    /**
     * Creates update listener for the variables under given path.
     * @param path context path to listen to (example: 'products' or 'products.shopId'). Can be '' to listen to all variables.
     */
    onUpdate: (path: string, callback: (event: VariableChangeEvent<any>) => void, options?: OnUpdateOptions) => UnregisterOnUpdateHandler;
  }
}
