const axios = require('axios');
const set = require('lodash/set');
const merge = require('lodash/merge');

const serverFunctions = [
{{#each functions}}
  {{#if context}}
    ['{{context}}.{{name}}', '{{id}}'],
  {{else}}
    ['{{name}}', '{{id}}'],
  {{/if}}
{{/each}}
];

module.exports = (clientID) => merge(
  {},
  serverFunctions.reduce(
    (acc, [path, id]) => set(acc, path, (...args) => axios.post(`{{apiBaseUrl}}/functions/custom/${id}/execute`, { clientID, args }).then(({ data }) => data)),
    {}
  )
);
