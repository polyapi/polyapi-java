const axios = require('axios');
const set = require('lodash/set');
const merge = require('lodash/merge');

const serverFunctions = [
{{#each specifications}}
  ['{{#if context}}{{context}}.{{/if}}{{name}}', '{{id}}',{{#each function.arguments}}'{{name}}',{{/each}}],
{{/each}}
];

module.exports = (clientID) => merge(
  {},
  serverFunctions.reduce(
    (acc, [path, id, ...argKeys]) => set(
      acc,
      path,
      (...args) => axios.post(
        `{{apiBaseUrl}}/functions/server/${id}/execute`,
        {
          clientID,
          args: argKeys.reduce((acc, key, index) => ({ ...acc, [key]: args[index] }), {})
        },
        { headers: { 'X-PolyApiKey': '{{apiKey}}' }}
      ).then(({ data }) => data)),
    {}
  )
);
