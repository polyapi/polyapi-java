const axios = require('../axios');
const set = require('lodash/set');
const merge = require('lodash/merge');

const functions = [
{{#each specifications}}
  ['{{#if context}}{{context}}.{{/if}}{{name}}', '{{id}}',{{#each function.arguments}}'{{name}}',{{/each}}],
{{/each}}
];

module.exports = (clientID) => merge(
  {},
  functions.reduce(
    (acc, [path, id, ...argKeys]) => set(
      acc,
      path,
      (...args) => axios.post(
        `/functions/api/${id}/execute`,
        {
          clientID,
          args: argKeys.reduce((acc, key, index) => ({ ...acc, [key]: args[index] }), {})
        },
      ).then(({ data }) => data)),
    {}
  )
);
