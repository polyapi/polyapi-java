{{!-- TODO figure out how to inject poly ahead of time --}}
{{!-- from polyapi import poly --}}
import logging
import sys
from typing import Any

logging.basicConfig(stream=sys.stdout, level=logging.DEBUG)

FUNCTION_ENVIRONMENT_ID = "{{environmentId}}"

{{{code}}}

def _get_args(request):
    return request.json.get("args", [])

def main(context):
    """
    The context parameter contains the Flask request object and any
    CloudEvent received with the request.
    """
    # TODO there might be a context.cloudevent we need to handle here sometimes?
    args = _get_args(context.request)
    try:
        result = {{name}}(*args)
    except Exception as e:
        return str(e), 500

    if result == None:
        result = ""
    elif isinstance(result, (int, float, bool)):
        # http body cant be non-string, non-array, non-object
        # also just sending back "9" breaks because flask interprets as status code
        # so do it this way, because OpenAI should be able to interpret this result I think
        result = f"({result}) {type(result)}"

    return result, 200