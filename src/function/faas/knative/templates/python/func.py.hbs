{{!-- TODO figure out how to inject poly ahead of time --}}
{{!-- from polyapi import poly --}}
import logging
import sys
from typing import Any

log_line_format = "[%(levelname)s] %(message)s"
logging.basicConfig(stream=sys.stdout, level=logging.INFO, format=log_line_format)

FUNCTION_ENVIRONMENT_ID = "{{environmentId}}"

{{{code}}}

def _get_args(request):
    return request.json.get("args", [])

def main(context):
    """
    The context parameter contains the Flask request object and any
    CloudEvent received with the request.
    """
    # TODO there might be a context.cloudevent we need to handle here sometimes?
    args = _get_args(context.request)
    try:
        result = {{name}}(*args)
    except Exception as e:
        return str(e), 500

    if result == None:
        result = ""
    elif isinstance(result, bool):
        result = str(result)
    elif isinstance(result, int):
        result = f'(int) {result}'
    elif isinstance(result, float):
        result = f'(float) {result}'

    return result, 200