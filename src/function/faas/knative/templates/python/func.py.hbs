{{!-- TODO figure out how to inject poly ahead of time --}}
{{!-- from polyapi import poly --}}

FUNCTION_ENVIRONMENT_ID = "{{environmentId}}"

{{{code}}}

def _get_args(request):
    return request.get_json()

def main(context):
    """
    Function template
    The context parameter contains the Flask request object and any
    CloudEvent received with the request.
    """
    # TODO handle args like we do with NodeJS
    # const args = context.cloudevent ? (Array.isArray(body.data) ? body.data : [body.data]) : body.args;
    # const processedArgs = args.map(arg => arg === '$poly-undefined-value' ? undefined : arg);

    # Add your business logic here
    # HACK for now, just pass the context to the code, then we can update the code and figure out how to manipulate!
    try:
        result = {{name}}(context)
    except Exception as e:
        return str(e), 500

    return result, 200