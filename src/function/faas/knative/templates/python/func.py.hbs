{{!-- TODO figure out how to inject poly ahead of time --}}
{{!-- from polyapi import poly --}}

FUNCTION_ENVIRONMENT_ID = "{{environmentId}}"

{{{code}}}

def _get_args(request):
    return request.json.get("args", [])

def main(context):
    """
    The context parameter contains the Flask request object and any
    CloudEvent received with the request.
    """
    # TODO there might be a context.cloudevent we need to handle here sometimes?
    args = _get_args(context.request)
    try:
        result = {{name}}(*args)
    except Exception as e:
        return str(e), 500

    return result, 200